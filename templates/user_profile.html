{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
:root { --background: #000000; --text: #FFFFFF; --accent: #ABFF00; --border-color: #222; }
body { margin: 0; padding: 0; font-family: 'Poppins', sans-serif; background-color: var(--background); color: var(--text); }
.profile-header { position: fixed; top: 0; left: 0; width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 20px 5%; z-index: 1000; box-sizing: border-box; background-color: rgba(0,0,0,0.5); backdrop-filter: blur(10px); }
.back-link a { color: var(--text); text-decoration: none; display: flex; align-items: center; gap: 10px; font-weight: 600; opacity: 0.8; transition: opacity 0.3s ease; }
.back-link a:hover { opacity: 1; }
.icon { width: 24px; height: 24px; }
main.profile-container { padding-top: 80px; }
.gallery-layout { display: grid; grid-template-columns: 2fr 1fr; gap: 15px; padding: 20px 5%; }
.main-image-wrapper { grid-column: 1 / 2; position: relative; overflow: hidden; border-radius: 10px; cursor: pointer; aspect-ratio: 1 / 1.25; display: grid; }
.main-image-wrapper > * { grid-area: 1 / 1; }
.main-image-wrapper .gallery-item { width: 100%; height: 100%; object-fit: cover; }
.profile-title-overlay { align-self: end; z-index: 2; padding: 20px; background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); }
.profile-title-overlay h1 { font-size: 2.5rem; margin: 0 0 5px; font-weight: 700; color: #fff; }
.profile-title-overlay p { font-size: 1.2rem; margin: 0; color: #ccc; }
.thumbnail-grid { grid-column: 2 / 3; display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 15px; }
.thumbnail-grid img { width: 100%; height: 100%; object-fit: cover; border-radius: 10px; cursor: pointer; }
.tabs-container { padding: 20px 5% 40px; }
.tab-nav { display: flex; border-bottom: 1px solid var(--border-color); }
.tab-link { padding: 15px 25px; cursor: pointer; font-weight: 600; color: #888; position: relative; transition: color 0.3s ease; }
.tab-link.active { color: var(--text); }
.tab-link.active::after { content: ''; position: absolute; bottom: -1px; left: 0; width: 100%; height: 2px; background-color: var(--accent); }
.tab-content { display: none; padding: 40px 0; }
.tab-content.active { display: block; }
.tab-content p { font-size: 1.1rem; line-height: 1.8; color: #ccc; margin: 0; }
.interest-tags { display: flex; flex-wrap: wrap; gap: 10px; }
.tag { background-color: #1a1a1a; border: 1px solid var(--border-color); padding: 8px 18px; border-radius: 50px; font-size: 0.9rem; color: #ccc; }
.fixed-cta-bar { position: fixed; bottom: 0; left: 0; width: 100%; background-color: rgba(10,10,10,0.9); backdrop-filter: blur(10px); padding: 20px 5%; box-sizing: border-box; display: flex; justify-content: center; border-top: 1px solid var(--border-color); z-index: 1001; }
.connect-btn { background-color: var(--accent); color: var(--background); text-decoration: none; padding: 15px 60px; border-radius: 50px; font-weight: 700; font-size: 1.1rem; transition: transform 0.3s ease; border: none; cursor: pointer; }
.connect-btn:hover { transform: scale(1.05); }
.lightbox { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.95); display: flex; justify-content: center; align-items: center; z-index: 100000; opacity: 0; visibility: hidden; transition: opacity 0.2s ease, visibility 0.2s ease; touch-action: pan-y; }
.lightbox.visible { opacity: 1; visibility: visible; }
.lightbox-content { position: relative; max-width: 90vw; max-height: 85vh; }
.lightbox-content img { width: 100%; height: 100%; max-height: 85vh; object-fit: contain; display: block; }
.lightbox-close { position: absolute; top: 20px; right: 30px; font-size: 3rem; color: #fff; cursor: pointer; user-select: none; }
.lightbox-nav { position: absolute; top: 50%; transform: translateY(-50%); width: 50px; height: 50px; background-color: rgba(255,255,255,0.12); border-radius: 50%; color: #fff; display: flex; justify-content: center; align-items: center; cursor: pointer; font-size: 2rem; user-select: none; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
.lightbox-prev { left: 20px; }
.lightbox-next { right: 20px; }
@media (max-width: 768px) {
    .gallery-layout { grid-template-columns: 1fr; }
    .thumbnail-grid { grid-column: 1 / -1; }
    .profile-title-overlay h1 { font-size: 2rem; }
    .profile-title-overlay p { font-size: 1rem; }
    .lightbox-nav { width: 44px; height: 44px; }
}
</style>

<header class="profile-header">
    <div class="back-link">
        <a href="{% url 'dashboard' %}" aria-label="Back to dashboard">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M15 18l-6-6 6-6"/>
            </svg>
            <span>Back</span>
        </a>
    </div>
</header>

<main class="profile-container">
    <section class="gallery-layout">
        <div class="main-image-wrapper">
            {% if profile.profile_image %}
                <img class="gallery-item" src="{{ profile.profile_image }}" alt="Main profile photo of {{ profile.user.username }}">
            {% else %}
                <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #2a2a2a, #1a1a1a); display: flex; align-items: center; justify-content: center; color: #666;">
                    No Main Image
                </div>
            {% endif %}
            <div class="profile-title-overlay">
                <h1>{{ profile.user.get_full_name|default:profile.user.username }}, {{ profile.age }}</h1>
                <p>{{ profile.tagline }}</p>
            </div>
        </div>
        
        <div class="thumbnail-grid">
            <!-- Additional photos for the profile -->
            {% with profile_id=profile.id %}
                {% if profile_id == 1 %}
                    <img class="gallery-item" src="https://images.pexels.com/photos/3775120/pexels-photo-3775120.jpeg" alt="{{ profile.user.username }} in a cafe">
                    <img class="gallery-item" src="https://images.pexels.com/photos/3769021/pexels-photo-3769021.jpeg" alt="{{ profile.user.username }} at a museum">
                    <img class="gallery-item" src="https://images.pexels.com/photos/3290067/pexels-photo-3290067.jpeg" alt="Architectural detail">
                    <img class="gallery-item" src="https://images.pexels.com/photos/3772510/pexels-photo-3772510.jpeg" alt="{{ profile.user.username }} laughing">
                {% elif profile_id == 2 %}
                    <img class="gallery-item" src="https://images.pexels.com/photos/208213/pexels-photo-208213.jpeg" alt="{{ profile.user.username }} working">
                    <img class="gallery-item" src="https://images.pexels.com/photos/358528/pexels-photo-358528.jpeg" alt="{{ profile.user.username }} traveling">
                    <img class="gallery-item" src="https://images.pexels.com/photos/256541/pexels-photo-256541.jpeg" alt="Architecture">
                    <img class="gallery-item" src="https://images.pexels.com/photos/2898170/pexels-photo-2898170.jpeg" alt="{{ profile.user.username }} relaxing">
                {% elif profile_id == 3 %}
                    <img class="gallery-item" src="https://images.pexels.com/photos/1648387/pexels-photo-1648387.jpeg" alt="{{ profile.user.username }} with music">
                    <img class="gallery-item" src="https://images.pexels.com/photos/2426085/pexels-photo-2426085.jpeg" alt="{{ profile.user.username }} in studio">
                    <img class="gallery-item" src="https://images.pexels.com/photos/167092/pexels-photo-167092.jpeg" alt="Vinyl collection">
                    <img class="gallery-item" src="https://images.pexels.com/photos/1699161/pexels-photo-1699161.jpeg" alt="{{ profile.user.username }} performing">
                {% else %}
                    <!-- Default additional photos for other profiles -->
                    <img class="gallery-item" src="https://images.pexels.com/photos/3775120/pexels-photo-3775120.jpeg" alt="{{ profile.user.username }} photo 1">
                    <img class="gallery-item" src="https://images.pexels.com/photos/3769021/pexels-photo-3769021.jpeg" alt="{{ profile.user.username }} photo 2">
                    <img class="gallery-item" src="https://images.pexels.com/photos/3290067/pexels-photo-3290067.jpeg" alt="{{ profile.user.username }} photo 3">
                    <img class="gallery-item" src="https://images.pexels.com/photos/3772510/pexels-photo-3772510.jpeg" alt="{{ profile.user.username }} photo 4">
                {% endif %}
            {% endwith %}
        </div>
    </section>
    
    <div class="tabs-container">
        <nav class="tab-nav" role="tablist">
            <div class="tab-link active" data-tab="perspective" role="tab" aria-selected="true" tabindex="0">Perspective</div>
            <div class="tab-link" data-tab="interests" role="tab" aria-selected="false" tabindex="-1">Interests</div>
        </nav>
        
        <div class="tab-content active" id="perspective" role="tabpanel">
            <p>{{ profile.about }}</p>
        </div>
        
        <div class="tab-content" id="interests" role="tabpanel">
            <div class="interest-tags">
                {% for interest in profile.interests.all %}
                    <span class="tag">{{ interest.name }}</span>
                {% empty %}
                    <span class="tag" style="color: #666;">No interests listed</span>
                {% endfor %}
            </div>
        </div>
    </div>
</main>

<div style="height: 120px;"></div>
<div class="fixed-cta-bar">
    <button class="connect-btn">CONNECT</button>
</div>

<div class="lightbox" id="lightbox" role="dialog" aria-modal="true" aria-hidden="true">
    <span class="lightbox-close" id="lightbox-close" aria-label="Close image viewer" tabindex="0">&times;</span>
    <div class="lightbox-nav lightbox-prev" id="lightbox-prev" aria-label="Previous image" tabindex="0">&#10094;</div>
    <div class="lightbox-content">
        <img src="" id="lightbox-img" alt="Lightbox image">
    </div>
    <div class="lightbox-nav lightbox-next" id="lightbox-next" aria-label="Next image" tabindex="0">&#10095;</div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const lightbox = document.getElementById("lightbox");
    if (!lightbox) return;
    
    const lightboxImg = document.getElementById("lightbox-img");
    let images = [];
    
    // Collect all gallery images
    document.querySelectorAll(".gallery-item").forEach(img => {
        const src = img.getAttribute("src");
        if (src) {
            images.push(src);
            // Preload images
            const preloadImg = new Image();
            preloadImg.src = src;
        }
    });
    
    let currentImageIndex = 0;
    
    function showLightbox(index) {
        currentImageIndex = index;
        lightboxImg.src = images[currentImageIndex];
        lightbox.classList.add("visible");
        lightbox.setAttribute("aria-hidden", "false");
        document.body.style.overflow = "hidden";
    }
    
    function hideLightbox() {
        lightbox.classList.remove("visible");
        lightbox.setAttribute("aria-hidden", "true");
        document.body.style.overflow = "";
    }
    
    function nextImage() {
        currentImageIndex = (currentImageIndex + 1) % images.length;
        lightboxImg.src = images[currentImageIndex];
    }
    
    function prevImage() {
        currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
        lightboxImg.src = images[currentImageIndex];
    }
    
    // Add click events to gallery images
    document.querySelectorAll(".gallery-item").forEach((img, index) => {
        img.addEventListener("click", () => showLightbox(index));
    });
    
    // Lightbox controls
    document.getElementById("lightbox-close").addEventListener("click", hideLightbox);
    lightbox.addEventListener("click", (e) => {
        if (e.target === lightbox) hideLightbox();
    });
    document.getElementById("lightbox-next").addEventListener("click", nextImage);
    document.getElementById("lightbox-prev").addEventListener("click", prevImage);
    
    // Keyboard navigation
    document.addEventListener("keydown", (e) => {
        if (lightbox.classList.contains("visible")) {
            if (e.key === "ArrowRight") nextImage();
            else if (e.key === "ArrowLeft") prevImage();
            else if (e.key === "Escape") hideLightbox();
        }
    });
    
    // Tab functionality
    const tabLinks = document.querySelectorAll(".tab-link");
    const tabContents = document.querySelectorAll(".tab-content");
    
    tabLinks.forEach(tab => {
        tab.addEventListener("click", (e) => {
            const tabId = e.currentTarget.getAttribute("data-tab");
            
            // Update tabs
            tabLinks.forEach(t => {
                t.classList.remove("active");
                t.setAttribute("aria-selected", "false");
                t.setAttribute("tabindex", "-1");
            });
            tabContents.forEach(content => content.classList.remove("active"));
            
            // Activate current tab
            e.currentTarget.classList.add("active");
            e.currentTarget.setAttribute("aria-selected", "true");
            e.currentTarget.setAttribute("tabindex", "0");
            
            const activeContent = document.getElementById(tabId);
            if (activeContent) activeContent.classList.add("active");
        });
    });
});
</script>
{% endblock %}
